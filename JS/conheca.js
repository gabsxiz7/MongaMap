//dados dos pontos turísticos
const pontosTuristicos = [
    {
        titulo: "Plataforma de Pesca",
        descricao: `
        <p>Fundada em 1979, a <strong>Plataforma de Pesca</strong> é um dos principais pontos turísticos de Mongaguá. Um lugar perfeito para pesca e lazer.
        A Plataforma de Pesca Amadora de Mongaguá, localizada na Praia do Centro, é um dos cartões-postais mais emblemáticos do município e um importante ponto turístico e cultural da região. Inaugurada em 1979, a estrutura foi projetada para ser uma das maiores plataformas de pesca da América Latina, consolidando Mongaguá como um destino atrativo para os amantes da pesca e do turismo.

        <p>Com uma extensão de 400 metros adentrando o mar e cerca de 6 metros de largura, a plataforma proporciona um ambiente ideal tanto para pescadores quanto para visitantes que buscam apreciar a vista panorâmica do oceano. Sua estrutura conta com iluminação adequada, permitindo a prática de pesca noturna, e oferece um espaço seguro para o lazer e convivência social.</p>

       <p>No entanto, ao longo dos anos, a plataforma enfrentou desafios relacionados à sua conservação. Exposta constantemente à ação do tempo e das intempéries marítimas, passou por diversas reformas para garantir a segurança e a funcionalidade. Uma das reformas mais significativas foi realizada na década de 2010, quando a estrutura recebeu melhorias importantes para continuar atraindo pescadores e turistas.
       A plataforma também é um ponto estratégico para a economia local, movimentando o turismo e o comércio ao seu redor. Com a presença de pescadores amadores de diversas regiões, há uma valorização das atividades pesqueiras tradicionais, além de gerar oportunidades para os comerciantes locais, como vendedores de equipamentos de pesca, alimentos e bebidas.</p>


       <p>Além da pesca, a plataforma é um espaço para contemplação e convívio social, oferecendo uma experiência única de interação com o ambiente marítimo. É comum que moradores e turistas aproveitem o local para caminhadas, sessões de fotografia e momentos de relaxamento ao som das ondas do mar.
       Com sua relevância histórica e cultural, a Plataforma de Pesca de Mongaguá não é apenas um ponto turístico, mas também um símbolo de identidade para a população local, representando a relação intrínseca da cidade com o mar e a pesca.</p>`,
    coords:[-24.134243, -46.692596]
    },

    {
        titulo: "Parque Ecológico",
        descricao: `
        <p>O <strong>Parque Ecológico</strong> "<em>A Tribuna</em>" é uma importante área de educação ambiental localizada em Mongaguá, São Paulo. Inaugurado em 1996, o parque ocupa uma área de 15 mil metros quadrados e tem como principal objetivo conscientizar o público sobre questões ambientais, incluindo o tráfico de animais silvestres, reciclagem e conservação da biodiversidade.</p>

       <p>Entre suas atrações, destacam-se recintos para jabutis, um serpentário com cobras peçonhentas e não peçonhentas, um viveiro interativo de aves, além de espaços que abrigam quatis, jacarés, tucanos e gaviões. O parque também conta com 15 aquários que exibem peixes tropicais e marinhos de diversas partes do mundo. Adicionalmente, há um espaço dedicado à educação ambiental, com acervos de conchas, sementes, pedras e areias de todas as praias do litoral de São Paulo, além de animais conservados em formol.</p>

       <p>Em janeiro de 2023, após mais de dois anos fechado para reformas, o parque foi reinaugurado. As melhorias incluíram a reconstrução de pontes, recuperação da vegetação, ampliação das áreas de passeio com pisos intertravados, revitalização dos telhados dos pavilhões e aquário, reforma dos viveiros e instalação de novos guarda-corpos. Novidades como um playground para crianças, novos viveiros para aves, macacos-prego e coelhos, além de um meliponário com abelhas nativas sem ferrão da espécie Jataí, foram incorporadas ao espaço.</p>

       <p>O parque está localizado na Avenida Governador Mário Covas Júnior, 10.410, no bairro Agenor de Campos, e funciona de terça a domingo, das 9h às 17h, com venda de ingressos até as 16h.</p>
       <ul>
          <li><p>O ingresso custa R$ 8,00, com meia-entrada de R$ 4,00 para estudantes e idosos acima de 60 anos.</p></li> 
          <li><p>Crianças até 7 anos e pessoas com deficiência têm entrada gratuita.</p></li>
          </ul>`,
coords: [-24.134406, -46.695230]
    },
    {
        titulo:"Paróquia Nossa Senhora Aparecida",
        descricao:`
        <p>A <strong>Paróquia Nossa Senhora Aparecida</strong>, localizada no centro de Mongaguá, São Paulo, é um marco histórico e religioso da cidade. Construída em 1949 em estilo colonial, a igreja abriga a imagem de Nossa Senhora da Conceição Aparecida, trazida diretamente de Aparecida do Norte. Além disso, possui imagens de santos como São José, Santa Rita de Cássia, São Judas Tadeu e Santa Luzia. Destacam-se também os vitrais coloridos que retratam cenas bíblicas, como a "Anunciação", o "Nascimento de Jesus", o "Cristo Redentor" e "Jesus rezando no horto das oliveiras", além de uma réplica da obra "Pietà", de Michelangelo.</p>

        <p>Anualmente, no dia 12 de outubro, a cidade celebra o dia de Nossa Senhora Aparecida, padroeira do município, com uma encenação no rio Mongaguá, próximo à igreja, representando o momento em que a imagem da santa foi encontrada nas águas do rio Paraíba do Sul. 
        A igreja está situada na Avenida São Paulo, 1679, no Centro de Mongaguá, entre o rio Mongaguá e uma praça com diversas espécies de palmeiras e outras árvores nativas, tornando-se um ponto de referência tanto para moradores quanto para visitantes.</p>`,
coords: [-24.094984, -46.620291]
    },
    {
        titulo:"Praia Flórida Mirim",
        descricao:`
        <p>A <strong>Praia Flórida Mirim</strong>, localizada no município de Mongaguá, litoral sul de São Paulo, destaca-se por sua tranquilidade e beleza natural. Urbanizada recentemente, a praia ainda preserva características de áreas mais afastadas, com poucos quiosques e casas de veraneio, proporcionando um ambiente sereno, especialmente na baixa temporada.</p> 

       <p>A faixa de areia é larga, composta por grãos grossos e compactados pela força do mar. As águas são calmas, com ondas discretas, tornando-a ideal para banhos de mar e momentos de lazer em família.</p> 

       <p>Durante o verão, o bairro próximo à praia organiza shows e feiras, oferecendo opções de entretenimento aos visitantes. A presença de coqueiros ao longo do calçadão adiciona um charme especial ao local, convidando para caminhadas e contemplação da paisagem.</p>

       <p>A Praia Flórida Mirim é uma excelente opção para quem busca um refúgio tranquilo, com menor movimentação turística, permitindo maior contato com a natureza e momentos de relaxamento à beira-mar.</p>`,
coords:[-24.132455, -46.711498]
    },
    {
        titulo:"Praça de Eventos Dudu Samba",
        descricao:`
        <p>A <strong>Praça de Eventos Dudu Samba</strong>, localizada em frente à Praia do Centro de Mongaguá, é um espaço multifuncional dedicado à realização de diversos eventos culturais e de entretenimento na cidade.</p> 

       <p>Ao longo dos anos, a praça tem sido palco de shows de artistas renomados, festivais e celebrações sazonais, como o tradicional "Festão na Praia", que ocorre anualmente durante o mês de julho.</p> 
    
       <p>Além disso, em dezembro de 2024, a dupla sertaneja Thaeme e Thiago se apresentou na praça em comemoração ao aniversário de Mongaguá, evidenciando a relevância do espaço para grandes eventos.</p>

       <p>A infraestrutura da praça inclui quiosques de alimentação, pista de skate e áreas destinadas ao lazer, tornando-a um ponto de encontro para moradores e turistas.</p> 

       <p>Durante a alta temporada, especialmente nos meses de verão, é comum a instalação de parques de diversão e feiras de artesanato, ampliando as opções de entretenimento para os visitantes.</p> 


       <p>A <strong>Praça de Eventos Dudu Samba</strong> não apenas dinamiza a vida cultural de Mongaguá, mas também contribui significativamente para a economia local, atraindo visitantes e fomentando o comércio na região central da cidade.</p>`,
coords: [-24.09606, -46.62045]
    },
    {
        titulo:"Poço das Antas",
        descricao:`
        <p>O <strong>Poço das Antas</strong>, situado em Mongaguá, São Paulo, é uma das principais atrações turísticas da cidade, reconhecido por sua beleza natural e relevância histórica. Localizado no Parque Turístico Umberto Salomone, entre a Serra do Mar e o centro de Mongaguá, o local oferece uma combinação única de cachoeiras, piscinas naturais e trilhas ecológicas. A origem do nome <em>"Poço das Antas"</em> possui duas explicações populares:</p>
       <ul>
         <li><p>Semelhança das pedras com antas: Indígenas da região acreditavam que as pedras do local assemelhavam-se às cabeças de antas.</p></li>
         <li><p>Presença de antas: As antas desciam da Serra do Mar para beber água na piscina natural formada pela cachoeira.</p></li>
        </ul>
       <p>O parque foi revitalizado e reinaugurado em dezembro de 2023, visando melhorar a infraestrutura para os visitantes. Atualmente, o local conta com banheiros, pontes com corrimão, lanchonetes, guarita e amplo estacionamento, proporcionando conforto e segurança aos frequentadores.
       O Poço das Antas é ideal para banhos, piqueniques e caminhadas pelas trilhas que levam a outras cachoeiras na região. O parque funciona diariamente das 9h às 17h, com ingressos vendidos até as 16h. As taxas de entrada são:</p>
       <ul>
         <li><strong>Ingresso</strong>: R$ 8,00</li>
         <li><p>Estudantes e idosos acima de 60 anos: R$ 4,00 (mediante comprovação)</p></li>
         <li><p>Crianças até 7 anos: entrada gratuita (com documentação comprobatória)</p></li>
         <li><p>Estacionamento para carros: R$ 10,00</p></li>
         <li><p>Estacionamento para motos: R$ 5,00</p></li>`,
coords: [-24.0935, -46.6225]
    },
    {
        titulo:"Feira de Artesanato do Centro",
        descricao:`
        <p>A <strong>Feira de Artesanato</strong> do Centro de Mongaguá é um ponto turístico significativo da cidade, destacando-se por sua arquitetura e variedade de produtos artesanais. Localizada na Rua Sete de Dezembro, próxima à Praça Jacoub Koukdjian, a feira é composta por 98 quiosques construídos em madeira maciça e tijolos aparentes, conferindo ao espaço um charme rústico e acolhedor.</p> 

       <p>A feira funciona principalmente nos finais de semana e feriados, oferecendo aos visitantes uma ampla gama de produtos artesanais que refletem a cultura e as tradições locais. Além das peças de artesanato, o espaço conta com diversas opções gastronômicas, proporcionando uma experiência completa para os frequentadores.</p>

       <p>Ao longo dos anos, a Feira de Artesanato do Centro de Mongaguá tem se consolidado como um espaço de valorização da cultura local, permitindo que artesãos exponham e comercializem seus trabalhos, além de servir como ponto de encontro para moradores e turistas que buscam lazer e entretenimento na cidade.</p>`,
coords: [-24.09462, -46.61961]
    },
    {
        titulo:"Morro da Padroeira",
        descricao:`
        <p>O Morro da Padroeira, localizado no centro de Mongaguá, São Paulo, é um dos principais pontos turísticos e religiosos da cidade. No topo do morro, destaca-se uma imponente estátua de Nossa Senhora Aparecida, padroeira do Brasil, com mais de 15 metros de altura e aproximadamente 2,5 toneladas. A imagem foi instalada em dezembro de 2006, após cerca de dois meses de construção pela artista plástica Eduarda Belchior.</p> 

       <p>Para acessar a estátua, os visitantes percorrem uma trilha urbana composta por uma passarela de madeira com 150 metros de extensão e 139 degraus, que atravessa uma área de mata nativa. No percurso, é possível avistar pássaros silvestres e, ao chegar ao deck situado a 30 metros acima do chão, desfrutar de uma vista panorâmica deslumbrante da região, incluindo a Serra do Mar, o bairro Vila São Paulo e a divisa com a cidade de Praia Grande.</p> 

      <p>Aos pés da estátua, encontra-se o Skate Park, um espaço dedicado à prática de esportes radicais, evidenciando a integração entre devoção religiosa e atividades de lazer no local. 
      O Morro da Padroeira não apenas simboliza a fé dos moradores de Mongaguá, mas também representa um importante atrativo turístico, oferecendo uma combinação única de espiritualidade, natureza e recreação.</p>`,
coords: [-24.0890, -46.6180]
    },
    {
        titulo: "Praia Agenor de Campos",
        descricao:`
        <p>A Praia de Agenor de Campos, localizada em Mongaguá, São Paulo, é uma das praias mais movimentadas da cidade, situada no Complexo Plataforma, próximo à Plataforma Marítima de Pesca Amadora e ao Parque Ecológico Turístico "A Tribuna".</p>

       <p>A história da praia está intimamente ligada ao desenvolvimento do bairro de Agenor de Campos, que ganhou destaque turístico com a inauguração da Plataforma de Pesca em 10 de março de 1979. Essa estrutura foi construída entre 1977 e 1979 pelo Governo do Estado de São Paulo em parceria com a Federação Paulista de Pesca e Lançamento (FPPL), com o objetivo de descentralizar o turismo que se concentrava no centro de Mongaguá, atraindo visitantes para a região de Agenor de Campos.</p> 

      <p>A praia possui uma extensão de aproximadamente 2 km, com areia escura e compacta, ideal para caminhadas e prática de exercícios. O mar é agitado, com ondas fortes, tornando-se um ponto atrativo para surfistas. A orla é urbanizada, contando com quiosques, coqueiros e uma feira de artesanato, além de uma estátua de Iemanjá, inaugurada em 2005, que homenageia a Rainha do Mar e é um local de veneração das religiões africanas.</p> 

      <p>Durante a alta temporada, especialmente no verão, a Praia de Agenor de Campos recebe diversos shows e eventos musicais, tornando-se um centro de entretenimento para moradores e turistas. A infraestrutura do bairro inclui pousadas, locais para camping e uma variedade de opções gastronômicas, atendendo às necessidades dos visitantes.</p> 

      <p>A Praia de Agenor de Campos destaca-se não apenas por suas belezas naturais, mas também por sua relevância histórica no desenvolvimento turístico de Mongaguá, consolidando-se como um importante destino no litoral paulista.</p>`,
coords: [-24.13087, -46.68704]
    },
    {
        titulo: "Centro Cultural Raul Cortez",
        descricao:`
        <p>O Centro Cultural Raul Cortez, localizado em Mongaguá, São Paulo, foi inaugurado em dezembro de 1996, sendo o primeiro centro de cultura do Litoral Sul Paulista. Nomeado em homenagem ao renomado ator brasileiro Raul Cortez, o espaço tornou-se o coração da cena cultural da cidade.</p>

       <p>O centro oferece uma variedade de cursos gratuitos para a população, incluindo música, pintura, teclado, violão, violino, hip hop, ballet, jazz, dança de rua, dança do ventre, teatro, dança de salão e coral.</p>

       <p>Além disso, abriga o Teatro Municipal Ronaldo Ciambroni, com capacidade para 320 espectadores, onde são realizados grandes espetáculos teatrais, exposições de arte e outros eventos culturais.</p> 

       <p>Em novembro de 2024, foi lançado o minidocumentário 'O Palco da Cultura de Mongaguá. Uma viagem por dentro do Centro Cultural Raul Cortez', que retrata os bastidores da construção, início das atividades e evolução do centro cultural. O documentário destaca a importância do espaço como um dos maiores polos de cultura da região, recebendo anualmente mais de 20 mil pessoas.</p> 

       <p>O Centro Cultural Raul Cortez continua a desempenhar um papel fundamental na promoção e desenvolvimento das artes em Mongaguá, oferecendo oportunidades de aprendizado e entretenimento para moradores e visitantes.</p>`,
coords: [-24.10203, -46.63637]
    }
];




// Variáveis globais para o mapa e QR Code scanner
let modalMap = null;
let qrScanner = null;

// Função para adicionar o mapa ao modal
function adicionarMapa(coords, titulo) {
    const mapElement = document.getElementById("modal-map");

    // Remove o mapa anterior se já existir
    if (modalMap) {
        modalMap.remove();
        modalMap = null;
    }

    // Inicializa o mapa com as coordenadas fornecidas
    modalMap = L.map(mapElement).setView(coords, 15);

    // Adiciona o tile layer do OpenStreetMap
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(modalMap);

    // Adiciona um marcador no local
    L.marker(coords).addTo(modalMap).bindPopup(titulo).openPopup();

    // Ajusta o tamanho do mapa após o modal ser exibido
    setTimeout(() => {
        modalMap.invalidateSize();
    }, 300);
}

// Função para abrir o modal com informações do ponto turístico
function abrirModal(index) {
    const ponto = pontosTuristicos[index];

    // Atualiza título e descrição
    document.getElementById("modal-title").textContent = ponto.titulo;
    document.getElementById("modal-description").innerHTML = ponto.descricao;

    // Exibe o modal
    const modal = document.getElementById("modal");
    modal.style.display = "block";

    // Aguarda o modal estar visível antes de inicializar o mapa e QR Code
    setTimeout(() => {
        if (ponto.coords) {
            adicionarMapa(ponto.coords, ponto.titulo);
        }

        // Inicia o scanner de QR Code corretamente
        iniciarLeitorQRCode();
    }, 500);
}

// Função para iniciar o leitor de QR Code
function iniciarLeitorQRCode() {
    if (qrScanner) {
        qrScanner.clear();
        qrScanner = null;
    }
    qrScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
    qrScanner.render(onScanSuccess, onScanError);
}


// Função executada ao escanear um QR Code com sucesso
function onScanSuccess(decodedText) {
  // 1) descodifica qualquer url-encoded leftover
  let text = decodeURIComponent(decodedText.trim());
  let id = null;

  // 2) tenta extrair scan ou id via URL
  try {
    const url = new URL(text);
    id = url.searchParams.get('scan') || url.searchParams.get('id');
  } catch {
    // não é URL válida — cai no fallback abaixo
  }

  // 3) se ainda não encontrou, tenta extrair o número direto no texto
  if (!id) {
    const m = text.match(/(?:scan|id)=(\d+)/);
    if (m) id = m[1];
  }

  if (!id) {
    alert('❌ QR inválido');
    return;
  }

  // 4) chama o endpoint
  fetch(`php/credita_pontos.php?id=${id}`)
    .then(r => r.json())
    .then(json => {
      if (json.sucesso) {
        alert(`🎉 +${json.pontosGanhos} pontos! Total: ${json.total}`);
        window.location.href = 'gamificacao.php?recompensa=1';
      } else {
        alert('❌ ' + (json.erro || 'Falha ao creditar'));
      }
    })
    .catch(() => alert('❌ Erro de rede'));
}


// Função executada se houver erro na leitura do QR Code
function onScanError(errorMessage) {
    console.warn(`Erro no scan: ${errorMessage}`);
}

// Fecha o modal e para os scanners ativos
document.querySelector('.close').addEventListener('click', () => {
    const modal = document.getElementById("modal");
    modal.style.display = "none";

    // Remove o mapa ao fechar o modal
    if (modalMap) {
        modalMap.remove();
        modalMap = null;
    }

    // Para a leitura do QR Code ao fechar o modal
    if (qrScanner) {
        qrScanner.clear();
        qrScanner = null;
    }
});

// Botão para fechar apenas o scanner (sem fechar o modal)
document.getElementById("btn-fechar-qr").addEventListener("click", () => {
    if (qrScanner) {
        qrScanner.clear();
        qrScanner = null;
    }

    document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const local = urlParams.get('local');
    if (local && !isNaN(local)) {
        // Lembrando que seu array é 0-indexado, então subtraia 1
        abrirModal(local - 1);
    }
});

    
});
